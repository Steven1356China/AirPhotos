<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirPhotos - èˆªç©ºå›¾ç‰‡åˆ†äº«å¹³å°</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        :root { 
            --primary: #0ea5e9; 
            --success: #10b981; 
            --warning: #f59e0b; 
            --danger: #ef4444; 
            --sky-blue: #e0f2fe;
            --gray-100: #f3f4f6; 
            --gray-800: #1f2937; 
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0369a1 0%, #0ea5e9 100%); 
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 25px 70px rgba(0,0,0,0.3); 
            overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.2);
        }
        .header { 
            background: linear-gradient(135deg, #0c4a6e 0%, #0369a1 100%); 
            color: white; 
            padding: 25px 40px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 3px solid #38bdf8;
        }
        .logo { 
            font-size: 28px; 
            font-weight: bold; 
            display: flex; 
            align-items: center; 
            gap: 12px;
            letter-spacing: -0.5px;
        }
        .logo-icon {
            font-size: 32px;
        }
        .user-menu { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
        }
        .avatar { 
            width: 44px; 
            height: 44px; 
            background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%); 
            color: white; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }
        .main-content { 
            display: flex; 
            min-height: 600px;
            background: #f8fafc;
        }
        .sidebar { 
            width: 280px; 
            background: white; 
            padding: 35px 25px; 
            border-right: 1px solid #e2e8f0;
            box-shadow: 2px 0 15px rgba(0,0,0,0.05);
        }
        .nav-item { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            padding: 16px 20px; 
            margin-bottom: 10px; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            color: #475569; 
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            border: 2px solid transparent;
        }
        .nav-item:hover { 
            background: #f0f9ff; 
            color: var(--primary);
            transform: translateX(5px);
            border-color: #e0f2fe;
        }
        .nav-item.active { 
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); 
            color: var(--primary); 
            border-color: #bae6fd;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
        }
        .content-area { 
            flex: 1; 
            padding: 35px; 
            background: #f8fafc;
        }
        .auth-forms, .user-dashboard { 
            display: none; 
        }
        .welcome-section { 
            text-align: center; 
            padding: 60px 20px; 
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            margin: 20px 0;
        }
        .welcome-section h1 {
            font-size: 42px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #0ea5e9, #0369a1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .features { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-top: 50px; 
        }
        .feature-card { 
            background: white; 
            border: 2px solid #e2e8f0; 
            border-radius: 16px; 
            padding: 30px; 
            text-align: center; 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .feature-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #38bdf8, #0ea5e9);
        }
        .feature-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 35px rgba(14, 165, 233, 0.2);
            border-color: #bae6fd;
        }
        .feature-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: inline-block;
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            padding: 20px;
            border-radius: 50%;
            color: #0369a1;
        }
        .form-container { 
            max-width: 450px; 
            margin: 0 auto; 
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .form-group { 
            margin-bottom: 25px; 
        }
        label { 
            display: block; 
            margin-bottom: 10px; 
            font-weight: 600; 
            color: var(--gray-800);
            font-size: 15px;
        }
        input, textarea, select { 
            width: 100%; 
            padding: 14px 18px; 
            border: 2px solid #e2e8f0; 
            border-radius: 10px; 
            font-size: 16px; 
            transition: all 0.3s;
            background: #f8fafc;
        }
        input:focus, textarea:focus, select:focus { 
            outline: none; 
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        .btn { 
            padding: 14px 28px; 
            border: none; 
            border-radius: 10px; 
            font-size: 16px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            gap: 10px;
            min-width: 140px;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); 
            color: white;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }
        .btn-success { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn-danger { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        .btn-outline { 
            background: transparent; 
            border: 2px solid var(--primary); 
            color: var(--primary);
            font-weight: 600;
        }
        .btn-outline:hover {
            background: #f0f9ff;
        }
        .message { 
            padding: 16px 20px; 
            border-radius: 10px; 
            margin-bottom: 25px; 
            display: none;
            font-size: 15px;
            line-height: 1.5;
        }
        .message.success { 
            background: #d1fae5; 
            color: #065f46; 
            border: 2px solid #a7f3d0; 
        }
        .message.error { 
            background: #fee2e2; 
            color: #991b1b; 
            border: 2px solid #fecaca; 
        }
        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #bfdbfe;
        }
        .upload-area { 
            border: 3px dashed #cbd5e1; 
            border-radius: 16px; 
            padding: 60px 40px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s; 
            margin-bottom: 35px;
            background: #f8fafc;
            position: relative;
            overflow: hidden;
        }
        .upload-area:hover { 
            border-color: var(--primary);
            background: #f0f9ff;
            transform: translateY(-2px);
        }
        .upload-area.dragover { 
            border-color: var(--primary);
            background: #e0f2fe;
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.2);
        }
        .upload-icon { 
            font-size: 64px; 
            color: var(--primary); 
            margin-bottom: 20px;
            opacity: 0.8;
        }
        .image-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 25px; 
            margin-top: 35px; 
        }
        .image-card { 
            background: white; 
            border-radius: 16px; 
            overflow: hidden; 
            box-shadow: 0 6px 20px rgba(0,0,0,0.08); 
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
        }
        .image-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: #bae6fd;
        }
        .image-preview { 
            width: 100%; 
            height: 220px; 
            object-fit: cover;
            border-bottom: 1px solid #e2e8f0;
        }
        .image-info { 
            padding: 20px; 
        }
        .status-badge { 
            display: inline-block; 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-size: 13px; 
            font-weight: 600; 
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        .status-pending { 
            background: #fef3c7; 
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .status-approved { 
            background: #d1fae5; 
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status-rejected { 
            background: #fee2e2; 
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content { 
            background: white; 
            border-radius: 20px; 
            padding: 35px; 
            max-width: 600px; 
            width: 90%; 
            max-height: 85vh; 
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }
        .close-modal { 
            background: none; 
            border: none; 
            font-size: 28px; 
            cursor: pointer; 
            color: #64748b;
            transition: color 0.3s;
            line-height: 1;
            padding: 5px;
        }
        .close-modal:hover {
            color: #0f172a;
        }
        .admin-controls { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        .stats-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 25px; 
            margin-bottom: 35px; 
        }
        .stat-card { 
            background: white; 
            border: 2px solid #e2e8f0; 
            border-radius: 16px; 
            padding: 25px; 
            text-align: center;
            transition: all 0.3s;
        }
        .stat-card:hover {
            border-color: #bae6fd;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.15);
        }
        .stat-number { 
            font-size: 40px; 
            font-weight: bold; 
            margin: 15px 0;
            background: linear-gradient(135deg, #0ea5e9, #0369a1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        @media (max-width: 768px) { 
            .main-content { 
                flex-direction: column; 
            } 
            .sidebar { 
                width: 100%; 
                order: 2;
            } 
            .header { 
                flex-direction: column; 
                gap: 20px; 
                text-align: center; 
                padding: 20px;
            } 
            .features { 
                grid-template-columns: 1fr; 
            }
            .content-area {
                padding: 25px;
            }
            .logo {
                font-size: 24px;
            }
        }
        .section-title {
            font-size: 28px;
            margin-bottom: 25px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .section-title:before {
            content: '';
            display: block;
            width: 4px;
            height: 24px;
            background: linear-gradient(to bottom, #0ea5e9, #0369a1);
            border-radius: 2px;
        }
        .airplane-bg {
            position: fixed;
            bottom: -50px;
            right: -50px;
            font-size: 300px;
            opacity: 0.03;
            z-index: -1;
            transform: rotate(-15deg);
            pointer-events: none;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #0ea5e9;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .image-counter {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .counter-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }
        .counter-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .tag {
            display: inline-block;
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            margin: 2px 4px 2px 0;
        }
    </style>
</head>
<body>
    <div class="airplane-bg">âœˆï¸</div>
    
    <div class="container">
        <div class="header">
            <div class="logo">
                <span class="logo-icon">âœˆï¸</span>
                <span>AirPhotos</span>
            </div>
            <div class="user-menu" id="userMenu">
                <div id="loggedInUser" style="display: none;">
                    <div class="avatar" id="userAvatar"></div>
                    <span id="userName" style="font-weight: 500;"></span>
                    <button class="btn btn-outline btn-sm" onclick="logout()">é€€å‡º</button>
                </div>
                <div id="loginButtons">
                    <button class="btn btn-outline" onclick="showAuth('login')">ç™»å½•</button>
                    <button class="btn btn-primary" onclick="showAuth('register')">æ³¨å†Œ</button>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <span>ğŸ </span> é¦–é¡µ
                </div>
                <div class="nav-item" onclick="showSection('upload')" id="navUpload">
                    <span>ğŸ“¤</span> ä¸Šä¼ å›¾ç‰‡
                </div>
                <div class="nav-item" onclick="showSection('myImages')" id="navMyImages">
                    <span>ğŸ–¼ï¸</span> æˆ‘çš„å›¾ç‰‡
                </div>
                <div class="nav-item" onclick="showSection('gallery')">
                    <span>ğŸ¨</span> å›¾ç‰‡ç”»å»Š
                </div>
                <div class="nav-item" onclick="showSection('admin')" id="navAdmin" style="display: none;">
                    <span>âš™ï¸</span> ç®¡ç†å‘˜é¢æ¿
                </div>
                <div class="nav-item" onclick="showSection('help')">
                    <span>â“</span> å¸®åŠ©ä¸­å¿ƒ
                </div>
            </div>
            
            <div class="content-area" id="contentArea">
                <div id="welcomePage" class="welcome-section">
                    <h1>âœˆï¸ AirPhotos - èˆªç©ºå›¾ç‰‡åˆ†äº«</h1>
                    <p style="font-size: 18px; color: #475569; margin-bottom: 30px;">åˆ†äº«ä½ çš„èˆªç©ºæ‘„å½±ä½œå“ï¼Œä¸å…¨çƒèˆªç©ºçˆ±å¥½è€…äº¤æµ</p>
                    <div class="features">
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ“¸</div>
                            <h3 style="margin-bottom: 10px; color: #0f172a;">ä¸“ä¸šèˆªç©ºæ‘„å½±</h3>
                            <p style="color: #64748b;">ä¸Šä¼ é£æœºã€æœºåœºã€èˆªå±•ç­‰èˆªç©ºé¢˜æå›¾ç‰‡</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">ğŸ‘ï¸</div>
                            <h3 style="margin-bottom: 10px; color: #0f172a;">å†…å®¹å®¡æ ¸ä¿éšœ</h3>
                            <p style="color: #64748b;">ç¡®ä¿å›¾ç‰‡è´¨é‡å’Œå†…å®¹åˆè§„æ€§</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">âš¡</div>
                            <h3 style="margin-bottom: 10px; color: #0f172a;">å¿«é€Ÿå±•ç¤ºåˆ†äº«</h3>
                            <p style="color: #64748b;">å®¡æ ¸é€šè¿‡åç«‹å³åœ¨ç”»å»Šå±•ç¤º</p>
                        </div>
                    </div>
                    <div style="margin-top: 50px;">
                        <button class="btn btn-primary btn-lg" onclick="showAuth('register')" style="padding: 16px 40px; font-size: 18px;">
                            âœˆï¸ ç«‹å³æ³¨å†Œå¼€å§‹åˆ†äº«
                        </button>
                        <p style="margin-top: 20px; color: #64748b; font-size: 14px;">å·²æœ‰è´¦æˆ·ï¼Ÿ <a href="javascript:void(0)" onclick="showAuth('login')" style="color: #0ea5e9; text-decoration: none; font-weight: 500;">ç‚¹å‡»ç™»å½•</a></p>
                    </div>
                </div>
                
                <div id="authSection" class="auth-forms">
                    <div class="form-container">
                        <div id="authTabs" style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px;">
                            <button class="btn btn-outline" onclick="showAuthTab('login')" style="flex: 1; padding: 12px;">ç™»å½•</button>
                            <button class="btn btn-outline" onclick="showAuthTab('register')" style="flex: 1; padding: 12px;">æ³¨å†Œ</button>
                        </div>
                        
                        <div id="loginForm">
                            <h2 style="margin-bottom: 25px; color: #0f172a;">ç™»å½• AirPhotos</h2>
                            <div class="message error" id="loginError"></div>
                            <div class="form-group">
                                <label>é‚®ç®±åœ°å€</label>
                                <input type="email" id="loginEmail" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label>å¯†ç </label>
                                <input type="password" id="loginPassword" placeholder="è¾“å…¥å¯†ç ">
                            </div>
                            <button class="btn btn-primary" onclick="login()" style="width: 100%; margin-top: 10px;">
                                <span id="loginSpinner" style="display: none;" class="loading-spinner"></span>
                                ç™»å½•
                            </button>
                        </div>
                        
                        <div id="registerForm" style="display: none;">
                            <h2 style="margin-bottom: 25px; color: #0f172a;">åŠ å…¥ AirPhotos</h2>
                            <div class="message error" id="registerError"></div>
                            <div class="message success" id="registerSuccess"></div>
                            <div class="form-group">
                                <label>é‚®ç®±åœ°å€</label>
                                <input type="email" id="registerEmail" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label>ç”¨æˆ·å</label>
                                <input type="text" id="registerUsername" placeholder="é€‰æ‹©å”¯ä¸€ç”¨æˆ·å">
                                <small style="color: #64748b; font-size: 13px;">å°†ä½œä¸ºæ‚¨åœ¨ç¤¾åŒºçš„æ˜¾ç¤ºåç§°</small>
                            </div>
                            <div class="form-group">
                                <label>å¯†ç </label>
                                <input type="password" id="registerPassword" placeholder="è‡³å°‘6ä½å­—ç¬¦">
                            </div>
                            <div class="form-group">
                                <label>ç¡®è®¤å¯†ç </label>
                                <input type="password" id="registerConfirm" placeholder="å†æ¬¡è¾“å…¥å¯†ç ">
                            </div>
                            <button class="btn btn-primary" onclick="register()" style="width: 100%;">
                                <span id="registerSpinner" style="display: none;" class="loading-spinner"></span>
                                æ³¨å†Œè´¦å·
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="userDashboard" class="user-dashboard">
                    <div id="uploadSection" style="display: none;">
                        <h2 class="section-title">ğŸ“¤ ä¸Šä¼ èˆªç©ºå›¾ç‰‡</h2>
                        <div class="message info" id="uploadInfo">
                            âœˆï¸ æ”¯æŒé£æœºã€æœºåœºã€èˆªå±•ç­‰èˆªç©ºé¢˜æå›¾ç‰‡ã€‚æ ¼å¼ï¼šJPGã€PNGï¼Œæœ€å¤§ 5MBã€‚ä¸Šä¼ åéœ€è¦ç®¡ç†å‘˜å®¡æ ¸ã€‚
                        </div>
                        
                        <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">ğŸ“</div>
                            <h3 style="margin-bottom: 10px; color: #0f172a;">æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»é€‰æ‹©</h3>
                            <p style="color: #64748b;">æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
                        </div>
                        
                        <div id="uploadForm" style="display: none;">
                            <h3 style="margin-bottom: 20px; color: #0f172a;">å›¾ç‰‡ä¿¡æ¯</h3>
                            <div class="form-group">
                                <label>å›¾ç‰‡æ ‡é¢˜ *</label>
                                <input type="text" id="imageTitle" placeholder="ä¾‹å¦‚ï¼šå›½èˆª B747-8 é™è½åŒ—äº¬é¦–éƒ½æœºåœº">
                            </div>
                            <div class="form-group">
                                <label>æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                                <textarea id="imageDescription" rows="3" placeholder="æ‹æ‘„åœ°ç‚¹ã€æ—¶é—´ã€æœºå‹ç­‰ä¿¡æ¯..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                                <input type="text" id="imageTags" placeholder="æ³¢éŸ³747, åŒ—äº¬æœºåœº, å›½èˆª, é™è½">
                                <small style="color: #64748b; font-size: 13px;">å»ºè®®æ ‡ç­¾ï¼šèˆªç©ºå…¬å¸ã€æœºå‹ã€æœºåœºã€æ‹æ‘„ç±»å‹ç­‰</small>
                            </div>
                            <div class="preview-container" style="margin: 25px 0; text-align: center;">
                                <img id="imagePreview" style="max-width: 100%; max-height: 300px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            </div>
                            <div style="display: flex; gap: 15px;">
                                <button class="btn btn-primary" onclick="uploadImage()" style="flex: 2;">
                                    <span id="uploadSpinner" style="display: none;" class="loading-spinner"></span>
                                    æäº¤ä¸Šä¼ 
                                </button>
                                <button class="btn btn-outline" onclick="cancelUpload()" style="flex: 1;">å–æ¶ˆ</button>
                            </div>
                        </div>
                        
                        <div id="uploadProgress" style="display: none; margin-top: 30px; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <h4 style="margin-bottom: 15px; color: #0f172a;">ä¸Šä¼ è¿›åº¦</h4>
                            <div style="background: #e2e8f0; height: 12px; border-radius: 6px; margin-bottom: 10px; overflow: hidden;">
                                <div id="progressBar" style="background: linear-gradient(90deg, #38bdf8, #0ea5e9); height: 100%; width: 0%; border-radius: 6px; transition: width 0.3s;"></div>
                            </div>
                            <p id="progressText" style="text-align: center; color: #64748b; font-size: 14px;">ä¸Šä¼ ä¸­...</p>
                        </div>
                    </div>
                    
                    <div id="myImagesSection" style="display: none;">
                        <h2 class="section-title">ğŸ–¼ï¸ æˆ‘çš„å›¾ç‰‡</h2>
                        <div class="image-counter">
                            <div class="counter-item">
                                <div class="counter-number" id="totalImages">0</div>
                                <div style="color: #64748b;">æ€»ä¸Šä¼ </div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="pendingCount" style="color: #f59e0b;">0</div>
                                <div style="color: #64748b;">å¾…å®¡æ ¸</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="approvedCount" style="color: #10b981;">0</div>
                                <div style="color: #64748b;">å·²é€šè¿‡</div>
                            </div>
                            <div class="counter-item">
                                <div class="counter-number" id="rejectedCount" style="color: #ef4444;">0</div>
                                <div style="color: #64748b;">è¢«æ‹’ç»</div>
                            </div>
                        </div>
                        <div class="image-grid" id="myImagesGrid">
                            <!-- å›¾ç‰‡å¡ç‰‡ä¼šåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div id="gallerySection" style="display: none;">
                        <h2 class="section-title">ğŸ¨ AirPhotos ç”»å»Š</h2>
                        <p style="margin-bottom: 25px; color: #64748b;">æµè§ˆæ‰€æœ‰é€šè¿‡å®¡æ ¸çš„èˆªç©ºæ‘„å½±ä½œå“ï¼Œå‘ç°ç²¾å½©ç¬é—´</p>
                        <div class="image-grid" id="publicGallery">
                            <!-- å…¬å…±å›¾ç‰‡ä¼šåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div id="adminSection" style="display: none;">
                        <h2 class="section-title">âš™ï¸ ç®¡ç†å‘˜é¢æ¿</h2>
                        
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div style="font-size: 18px; color: #64748b;">ğŸ“‹ å¾…å®¡æ ¸</div>
                                <div class="stat-number" id="adminPending">0</div>
                                <div style="color: #64748b;">å¼ å›¾ç‰‡ç­‰å¾…å®¡æ ¸</div>
                            </div>
                            <div class="stat-card">
                                <div style="font-size: 18px; color: #64748b;">ğŸ“Š æ€»æ•°</div>
                                <div class="stat-number" id="adminTotal">0</div>
                                <div style="color: #64748b;">å¹³å°å›¾ç‰‡æ€»æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div style="font-size: 18px; color: #64748b;">ğŸ‘¥ ç”¨æˆ·</div>
                                <div class="stat-number" id="adminUsers">0</div>
                                <div style="color: #64748b;">æ³¨å†Œç”¨æˆ·æ•°</div>
                            </div>
                        </div>
                        
                        <div class="admin-controls">
                            <button class="btn btn-primary" onclick="loadPendingImages()">
                                <span id="refreshSpinner" style="display: none;" class="loading-spinner"></span>
                                åˆ·æ–°å¾…å®¡æ ¸
                            </button>
                            <button class="btn btn-success" onclick="approveAllSelected()">æ‰¹é‡é€šè¿‡</button>
                            <button class="btn btn-danger" onclick="rejectAllSelected()">æ‰¹é‡æ‹’ç»</button>
                        </div>
                        
                        <div id="adminImagesList" style="margin-top: 30px;">
                            <!-- å¾…å®¡æ ¸å›¾ç‰‡åˆ—è¡¨ -->
                        </div>
                    </div>
                    
                    <div id="helpSection" style="display: none;">
                        <h2 class="section-title">â“ AirPhotos å¸®åŠ©ä¸­å¿ƒ</h2>
                        <div style="max-width: 800px; line-height: 1.6; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                            <h3 style="margin-bottom: 20px; color: #0f172a;">ğŸ“‹ å¸¸è§é—®é¢˜</h3>
                            <div style="margin-bottom: 30px;">
                                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #0ea5e9;">
                                    <h4 style="margin-bottom: 10px; color: #0f172a;">Q: å¯ä»¥ä¸Šä¼ ä»€ä¹ˆç±»å‹çš„å›¾ç‰‡ï¼Ÿ</h4>
                                    <p style="color: #475569;">A: AirPhotos ä¸“ä¸ºèˆªç©ºçˆ±å¥½è€…è®¾è®¡ï¼Œæ”¯æŒé£æœºã€æœºåœºã€èˆªå±•ã€èˆªç©ºå™¨ç­‰ç›¸å…³å›¾ç‰‡ã€‚æ ¼å¼ï¼šJPGã€PNGï¼Œæœ€å¤§5MBã€‚</p>
                                </div>
                                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #10b981;">
                                    <h4 style="margin-bottom: 10px; color: #0f172a;">Q: å®¡æ ¸éœ€è¦å¤šä¹…ï¼Ÿ</h4>
                                    <p style="color: #475569;">A: é€šå¸¸24å°æ—¶å†…å®Œæˆå®¡æ ¸ã€‚é«˜è´¨é‡ã€æ¸…æ™°ã€ç¬¦åˆèˆªç©ºä¸»é¢˜çš„å›¾ç‰‡æ›´å®¹æ˜“é€šè¿‡ã€‚</p>
                                </div>
                                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #f59e0b;">
                                    <h4 style="margin-bottom: 10px; color: #0f172a;">Q: å›¾ç‰‡è¢«æ‹’ç»æ€ä¹ˆåŠï¼Ÿ</h4>
                                    <p style="color: #475569;">A: ä½ ä¼šæ”¶åˆ°æ‹’ç»åŸå› ã€‚è¯·ç¡®ä¿å›¾ç‰‡æ¸…æ™°ã€å†…å®¹ç›¸å…³ã€æ— ç‰ˆæƒé—®é¢˜ã€‚å¯æ ¹æ®åé¦ˆä¿®æ”¹åé‡æ–°ä¸Šä¼ ã€‚</p>
                                </div>
                                <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #8b5cf6;">
                                    <h4 style="margin-bottom: 10px; color: #0f172a;">Q: å¦‚ä½•æˆä¸ºç®¡ç†å‘˜ï¼Ÿ</h4>
                                    <p style="color: #475569;">A: è¯·è”ç³»ç½‘ç«™æ‰€æœ‰è€…ï¼Œæä¾›ä½ çš„æ³¨å†Œé‚®ç®±ã€‚ç®¡ç†å‘˜è´¦å·éœ€è¦åœ¨ä»£ç ä¸­é…ç½®ã€‚</p>
                                </div>
                            </div>
                            
                            <h3 style="margin-bottom: 20px; color: #0f172a;">âœˆï¸ å›¾ç‰‡è¦æ±‚ä¸æŒ‡å—</h3>
                            <div style="background: #f0f9ff; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                                <h4 style="margin-bottom: 15px; color: #0369a1;">æ¨èæ ‡ç­¾ç¤ºä¾‹ï¼š</h4>
                                <div>
                                    <span class="tag">æ³¢éŸ³747</span>
                                    <span class="tag">ç©ºå®¢A380</span>
                                    <span class="tag">åŒ—äº¬é¦–éƒ½æœºåœº</span>
                                    <span class="tag">ä¸Šæµ·æµ¦ä¸œæœºåœº</span>
                                    <span class="tag">èˆªå±•</span>
                                    <span class="tag">é™è½</span>
                                    <span class="tag">èµ·é£</span>
                                    <span class="tag">å›½èˆª</span>
                                    <span class="tag">å—èˆª</span>
                                    <span class="tag">å¤œé—´æ‘„å½±</span>
                                </div>
                            </div>
                            
                            <div style="background: #f1f5f9; padding: 20px; border-radius: 12px;">
                                <h4 style="margin-bottom: 15px; color: #0f172a;">ğŸ“ è”ç³»æˆ‘ä»¬</h4>
                                <p style="color: #475569;">å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š</p>
                                <ul style="color: #475569; padding-left: 20px; margin-top: 10px;">
                                    <li>GitHub Issues: <a href="https://github.com/Steven1356China/AirPhotos/issues" style="color: #0ea5e9; text-decoration: none;">æäº¤é—®é¢˜</a></li>
                                    <li>ç®¡ç†å‘˜é‚®ç®±: admin@airphotos.com</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="imageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" style="margin: 0; color: #0f172a;">å›¾ç‰‡è¯¦æƒ…</h2>
                <button class="close-modal" onclick="closeModal()">Ã—</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        // ğŸ”§ æ›¿æ¢ä¸ºä½ çš„ Supabase é…ç½®ï¼ˆéƒ¨ç½²æ—¶éœ€è¦ä¿®æ”¹ï¼‰
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        let currentUser = null;
        let isAdmin = false;
        let selectedFile = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            loadPublicGallery();
        });
        
        async function checkAuth() {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (session?.user) {
                currentUser = session.user;
                await loadUserProfile();
                showUserDashboard();
            } else {
                showWelcomePage();
            }
        }
        
        async function loadUserProfile() {
            if (!currentUser) return;
            
            const { data: profile, error } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', currentUser.id)
                .single();
            
            if (profile) {
                isAdmin = currentUser.email === 'admin@example.com';
                
                document.getElementById('userAvatar').textContent = 
                    profile.username ? profile.username[0].toUpperCase() : currentUser.email[0].toUpperCase();
                document.getElementById('userName').textContent = profile.username || currentUser.email;
                
                document.getElementById('loggedInUser').style.display = 'flex';
                document.getElementById('loginButtons').style.display = 'none';
                
                if (isAdmin) {
                    document.getElementById('navAdmin').style.display = 'block';
                }
                
                loadMyImages();
                if (isAdmin) loadAdminData();
            }
        }
        
        function showWelcomePage() {
            hideAllSections();
            document.getElementById('welcomePage').style.display = 'block';
            document.getElementById('loggedInUser').style.display = 'none';
            document.getElementById('loginButtons').style.display = 'flex';
            document.getElementById('userMenu').style.display = 'flex';
        }
        
        function showUserDashboard() {
            hideAllSections();
            document.getElementById('userDashboard').style.display = 'block';
            showSection('dashboard');
        }
        
        function showAuth(type) {
            hideAllSections();
            document.getElementById('authSection').style.display = 'block';
            showAuthTab(type);
        }
        
        function showAuthTab(type) {
            document.getElementById('loginForm').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('registerForm').style.display = type === 'register' ? 'block' : 'none';
        }
        
        function showSection(section) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event?.target?.classList?.add('active');
            
            const sections = ['uploadSection', 'myImagesSection', 'gallerySection', 'adminSection', 'helpSection'];
            sections.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            switch(section) {
                case 'upload':
                    document.getElementById('uploadSection').style.display = 'block';
                    break;
                case 'myImages':
                    document.getElementById('myImagesSection').style.display = 'block';
                    loadMyImages();
                    break;
                case 'gallery':
                    document.getElementById('gallerySection').style.display = 'block';
                    break;
                case 'admin':
                    if (isAdmin) {
                        document.getElementById('adminSection').style.display = 'block';
                        loadAdminData();
                    }
                    break;
                case 'help':
                    document.getElementById('helpSection').style.display = 'block';
                    break;
                case 'dashboard':
                default:
                    document.getElementById('uploadSection').style.display = 'block';
                    break;
            }
        }
        
        function hideAllSections() {
            document.getElementById('welcomePage').style.display = 'none';
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
        }
        
        async function register() {
            const email = document.getElementById('registerEmail').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirm').value;
            
            const errorEl = document.getElementById('registerError');
            const successEl = document.getElementById('registerSuccess');
            const spinner = document.getElementById('registerSpinner');
            
            if (!email || !username || !password) {
                showMessage(errorEl, 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }
            
            if (password !== confirm) {
                showMessage(errorEl, 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (password.length < 6) {
                showMessage(errorEl, 'å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦');
                return;
            }
            
            try {
                spinner.style.display = 'inline-block';
                
                const { data: authData, error: authError } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: { username }
                    }
                });
                
                if (authError) throw authError;
                
                const { error: profileError } = await supabase
                    .from('profiles')
                    .insert([
                        {
                            id: authData.user.id,
                            username: username,
                            created_at: new Date()
                        }
                    ]);
                
                if (profileError) throw profileError;
                
                spinner.style.display = 'none';
                showMessage(successEl, 'ğŸ‰ æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥é‚®ç®±éªŒè¯é‚®ä»¶ï¼Œç„¶åç™»å½•ã€‚');
                showAuthTab('login');
                
            } catch (error) {
                spinner.style.display = 'none';
                showMessage(errorEl, error.message);
            }
        }
        
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            const spinner = document.getElementById('loginSpinner');
            
            if (!email || !password) {
                showMessage(errorEl, 'è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ');
                return;
            }
            
            try {
                spinner.style.display = 'inline-block';
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                await loadUserProfile();
                showUserDashboard();
                
                spinner.style.display = 'none';
                
            } catch (error) {
                spinner.style.display = 'none';
                showMessage(errorEl, error.message);
            }
        }
        
        async function logout() {
            await supabase.auth.signOut();
            currentUser = null;
            isAdmin = false;
            showWelcomePage();
        }
        
        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                handleFileSelect({ target: { files: e.dataTransfer.files } });
            }
        });
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showMessage(document.getElementById('uploadInfo'), 'è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼ˆJPGã€PNGæ ¼å¼ï¼‰', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showMessage(document.getElementById('uploadInfo'), 'å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB', 'error');
                return;
            }
            
            selectedFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('imagePreview').src = e.target.result;
            };
            reader.readAsDataURL(file);
            
            document.getElementById('uploadForm').style.display = 'block';
            document.getElementById('uploadInfo').style.display = 'none';
        }
        
        function cancelUpload() {
            selectedFile = null;
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('uploadInfo').style.display = 'block';
            document.getElementById('fileInput').value = '';
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageDescription').value = '';
            document.getElementById('imageTags').value = '';
        }
        
        async function uploadImage() {
            if (!selectedFile || !currentUser) return;
            
            const title = document.getElementById('imageTitle').value.trim();
            const description = document.getElementById('imageDescription').value.trim();
            const tags = document.getElementById('imageTags').value.split(',').map(t => t.trim()).filter(t => t);
            
            if (!title) {
                showMessage(document.getElementById('uploadInfo'), 'è¯·å¡«å†™å›¾ç‰‡æ ‡é¢˜', 'error');
                return;
            }
            
            document.getElementById('uploadProgress').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
            const spinner = document.getElementById('uploadSpinner');
            spinner.style.display = 'inline-block';
            
            try {
                const fileExt = selectedFile.name.split('.').pop();
                const fileName = `${Date.now()}-${Math.random().toString(36).substr(2)}.${fileExt}`;
                const filePath = `${currentUser.id}/${fileName}`;
                
                document.getElementById('progressText').textContent = 'ä¸Šä¼ å›¾ç‰‡ä¸­...';
                document.getElementById('progressBar').style.width = '30%';
                
                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('user-uploads')
                    .upload(filePath, selectedFile, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (uploadError) throw uploadError;
                
                document.getElementById('progressBar').style.width = '60%';
                document.getElementById('progressText').textContent = 'å¤„ç†å›¾ç‰‡ä¿¡æ¯...';
                
                const { data: { publicUrl } } = supabase.storage
                    .from('user-uploads')
                    .getPublicUrl(filePath);
                
                const { data: dbData, error: dbError } = await supabase
                    .from('images')
                    .insert([
                        {
                            user_id: currentUser.id,
                            title: title,
                            description: description,
                            image_url: publicUrl,
                            status: 'pending',
                            tags: tags,
                            uploaded_at: new Date()
                        }
                    ]);
                
                if (dbError) throw dbError;
                
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressText').textContent = 'ä¸Šä¼ æˆåŠŸï¼';
                spinner.style.display = 'none';
                
                setTimeout(() => {
                    cancelUpload();
                    document.getElementById('uploadProgress').style.display = 'none';
                    loadMyImages();
                    showMessage(document.getElementById('uploadInfo'), 'âœ… å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼è¯·ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚', 'success');
                }, 1000);
                
            } catch (error) {
                document.getElementById('uploadProgress').style.display = 'none';
                spinner.style.display = 'none';
                showMessage(document.getElementById('uploadInfo'), 'ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function loadMyImages() {
            if (!currentUser) return;
            
            const { data: images, error } = await supabase
                .from('images')
                .select('*')
                .eq('user_id', currentUser.id)
                .order('uploaded_at', { ascending: false });
            
            if (error) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
                return;
            }
            
            const total = images.length;
            const pending = images.filter(img => img.status === 'pending').length;
            const approved = images.filter(img => img.status === 'approved').length;
            const rejected = images.filter(img => img.status === 'rejected').length;
            
            document.getElementById('totalImages').textContent = total;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('approvedCount').textContent = approved;
            document.getElementById('rejectedCount').textContent = rejected;
            
            const grid = document.getElementById('myImagesGrid');
            grid.innerHTML = '';
            
            images.forEach(image => {
                const card = createImageCard(image, true);
                grid.appendChild(card);
            });
        }
        
        async function loadPublicGallery() {
            const { data: images, error } = await supabase
                .from('images')
                .select('*, profiles(username)')
                .eq('status', 'approved')
                .order('uploaded_at', { ascending: false });
            
            if (error) {
                console.error('åŠ è½½ç”»å»Šå¤±è´¥:', error);
                return;
            }
            
            const gallery = document.getElementById('publicGallery');
            gallery.innerHTML = '';
            
            images.forEach(image => {
                const card = createImageCard(image, false);
                gallery.appendChild(card);
            });
        }
        
        function createImageCard(image, isOwn = false) {
            const card = document.createElement('div');
            card.className = 'image-card';
            
            const statusText = {
                'pending': 'â³ å¾…å®¡æ ¸',
                'approved': 'âœ… å·²é€šè¿‡',
                'rejected': 'âŒ å·²æ‹’ç»'
            };
            
            const statusColor = {
                'pending': 'status-pending',
                'approved': 'status-approved',
                'rejected': 'status-rejected'
            };
            
            const tagsHtml = image.tags?.map(tag => `<span class="tag">${tag}</span>`).join('') || '';
            
            card.innerHTML = `
                <img src="${image.image_url}" class="image-preview" alt="${image.title}" loading="lazy">
                <div class="image-info">
                    <div class="${statusColor[image.status]} status-badge">
                        ${statusText[image.status]}
                    </div>
                    <h4 style="margin-bottom: 8px; color: #0f172a; font-size: 16px;">${image.title || 'æœªå‘½åå›¾ç‰‡'}</h4>
                    <p style="font-size: 12px; color: #64748b; margin-bottom: 8px;">
                        ğŸ“… ${new Date(image.uploaded_at).toLocaleDateString('zh-CN', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        })}
                    </p>
                    ${image.description ? `<p style="font-size: 14px; color: #475569; margin-bottom: 12px; line-height: 1.4;">${image.description.substring(0, 60)}${image.description.length > 60 ? '...' : ''}</p>` : ''}
                    ${tagsHtml ? `<div style="margin-bottom: 15px;">${tagsHtml}</div>` : ''}
                    <button class="btn btn-outline" style="width: 100%; padding: 10px;" onclick="viewImageDetail('${image.id}', ${isOwn})">
                        ğŸ‘ï¸ æŸ¥çœ‹è¯¦æƒ…
                    </button>
                </div>
            `;
            
            return card;
        }
        
        async function viewImageDetail(imageId, isOwn = false) {
            const { data: image, error } = await supabase
                .from('images')
                .select('*, profiles(username)')
                .eq('id', imageId)
                .single();
            
            if (error) {
                alert('åŠ è½½å›¾ç‰‡è¯¦æƒ…å¤±è´¥');
                return;
            }
            
            let modalContent = '';
            
            if (isOwn || isAdmin) {
                modalContent = `
                    <div style="text-align: center;">
                        <img src="${image.image_url}" style="max-width: 100%; max-height: 400px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #0f172a;">${image.title || 'æœªå‘½åå›¾ç‰‡'}</h3>
                        ${image.description ? `<p style="margin-bottom: 20px; color: #475569; line-height: 1.6;">${image.description}</p>` : ''}
                        <div style="margin: 25px 0; padding: 20px; background: #f8fafc; border-radius: 12px; text-align: left;">
                            <p style="margin-bottom: 10px;"><strong>çŠ¶æ€:</strong> 
                                <span class="${image.status === 'pending' ? 'status-pending' : image.status === 'approved' ? 'status-approved' : 'status-rejected'} status-badge" style="margin-left: 10px;">
                                    ${image.status === 'pending' ? 'â³ å¾…å®¡æ ¸' : image.status === 'approved' ? 'âœ… å·²é€šè¿‡' : 'âŒ å·²æ‹’ç»'}
                                </span>
                            </p>
                            <p style="margin-bottom: 10px;"><strong>ä¸Šä¼ æ—¶é—´:</strong> ${new Date(image.uploaded_at).toLocaleString('zh-CN')}</p>
                            ${image.reviewed_at ? `<p style="margin-bottom: 10px;"><strong>å®¡æ ¸æ—¶é—´:</strong> ${new Date(image.reviewed_at).toLocaleString('zh-CN')}</p>` : ''}
                            ${image.rejection_reason ? `<p style="margin-bottom: 10px;"><strong>æ‹’ç»åŸå› :</strong> ${image.rejection_reason}</p>` : ''}
                            ${image.tags?.length ? `<p style="margin-bottom: 10px;"><strong>æ ‡ç­¾:</strong> ${image.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}</p>` : ''}
                            <p style="margin-bottom: 0;"><strong>å›¾ç‰‡ID:</strong> ${image.id.substring(0, 8)}...</p>
                        </div>
                        ${image.status === 'pending' && isOwn ? `
                            <button class="btn btn-danger" onclick="deleteImage('${image.id}')" style="margin-top: 15px;">ğŸ—‘ï¸ åˆ é™¤å›¾ç‰‡</button>
                        ` : ''}
                    </div>
                `;
            } else {
                modalContent = `
                    <div style="text-align: center;">
                        <img src="${image.image_url}" style="max-width: 100%; max-height: 400px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #0f172a;">${image.title || 'æœªå‘½åå›¾ç‰‡'}</h3>
                        ${image.description ? `<p style="margin-bottom: 20px; color: #475569; line-height: 1.6;">${image.description}</p>` : ''}
                        <div style="margin: 25px 0; padding: 20px; background: #f8fafc; border-radius: 12px; text-align: left;">
                            <p style="margin-bottom: 10px;"><strong>ä¸Šä¼ è€…:</strong> ${image.profiles?.username || 'åŒ¿åç”¨æˆ·'}</p>
                            <p style="margin-bottom: 10px;"><strong>ä¸Šä¼ æ—¶é—´:</strong> ${new Date(image.uploaded_at).toLocaleDateString('zh-CN', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric'
                            })}</p>
                            ${image.tags?.length ? `<p style="margin-bottom: 0;"><strong>æ ‡ç­¾:</strong> ${image.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}</p>` : ''}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('modalTitle').textContent = image.title || 'å›¾ç‰‡è¯¦æƒ…';
            document.getElementById('modalContent').innerHTML = modalContent;
            document.getElementById('imageModal').style.display = 'flex';
        }
        
        async function deleteImage(imageId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) return;
            
            try {
                const { error } = await supabase
                    .from('images')
                    .delete()
                    .eq('id', imageId);
                
                if (error) throw error;
                
                closeModal();
                loadMyImages();
                showMessage(document.getElementById('uploadInfo'), 'ğŸ—‘ï¸ å›¾ç‰‡åˆ é™¤æˆåŠŸ', 'success');
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }
        
        async function loadAdminData() {
            if (!isAdmin) return;
            
            const { count: pendingCount } = await supabase
                .from('images')
                .select('*', { count: 'exact', head: true })
                .eq('status', 'pending');
            
            const { count: totalCount } = await supabase
                .from('images')
                .select('*', { count: 'exact', head: true });
            
            const { count: userCount } = await supabase
                .from('profiles')
                .select('*', { count: 'exact', head: true });
            
            document.getElementById('adminPending').textContent = pendingCount || 0;
            document.getElementById('adminTotal').textContent = totalCount || 0;
            document.getElementById('adminUsers').textContent = userCount || 0;
            
            loadPendingImages();
        }
        
        async function loadPendingImages() {
            if (!isAdmin) return;
            
            const spinner = document.getElementById('refreshSpinner');
            spinner.style.display = 'inline-block';
            
            const { data: images, error } = await supabase
                .from('images')
                .select('*, profiles(username)')
                .eq('status', 'pending')
                .order('uploaded_at', { ascending: false });
            
            spinner.style.display = 'none';
            
            if (error) {
                console.error('åŠ è½½å¾…å®¡æ ¸å›¾ç‰‡å¤±è´¥:', error);
                showMessage(document.getElementById('uploadInfo'), 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                return;
            }
            
            const list = document.getElementById('adminImagesList');
            
            if (images.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                        <div style="font-size: 48px; margin-bottom: 20px;">âœ…</div>
                        <h3 style="color: #0f172a; margin-bottom: 10px;">æš‚æ— å¾…å®¡æ ¸å›¾ç‰‡</h3>
                        <p style="color: #64748b;">æ‰€æœ‰å›¾ç‰‡éƒ½å·²å®¡æ ¸å®Œæ¯•</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #0f172a;">å¾…å®¡æ ¸å›¾ç‰‡ (${images.length}å¼ )</h3>
                <div style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
            `;
            
            images.forEach((image, index) => {
                const tagsHtml = image.tags?.map(tag => `<span class="tag">${tag}</span>`).join('') || '';
                
                list.innerHTML += `
                    <div style="padding: 20px; border-bottom: ${index < images.length - 1 ? '1px solid #e2e8f0' : 'none'};">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <img src="${image.image_url}" style="width: 180px; height: 120px; object-fit: cover; border-radius: 10px; flex-shrink: 0;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <h4 style="margin: 0; color: #0f172a; font-size: 16px;">${image.title || 'æœªå‘½åå›¾ç‰‡'}</h4>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn btn-success btn-sm" onclick="approveImage('${image.id}')" style="padding: 8px 16px; font-size: 14px;">âœ… é€šè¿‡</button>
                                        <button class="btn btn-danger btn-sm" onclick="showRejectModal('${image.id}')" style="padding: 8px 16px; font-size: 14px;">âŒ æ‹’ç»</button>
                                        <button class="btn btn-outline btn-sm" onclick="viewImageDetail('${image.id}', false)" style="padding: 8px 16px; font-size: 14px;">ğŸ‘ï¸ æŸ¥çœ‹</button>
                                    </div>
                                </div>
                                <p style="color: #64748b; font-size: 14px; margin-bottom: 8px;">
                                    <strong>ä¸Šä¼ è€…:</strong> ${image.profiles?.username || 'åŒ¿åç”¨æˆ·'} | 
                                    <strong>æ—¶é—´:</strong> ${new Date(image.uploaded_at).toLocaleString('zh-CN', { 
                                        month: 'short', 
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}
                                </p>
                                ${image.description ? `<p style="color: #475569; font-size: 14px; margin-bottom: 10px;">${image.description.substring(0, 120)}${image.description.length > 120 ? '...' : ''}</p>` : ''}
                                ${tagsHtml ? `<div style="margin-bottom: 10px;">${tagsHtml}</div>` : ''}
                                <label style="display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" class="select-image" data-id="${image.id}" style="width: 18px; height: 18px; cursor: pointer;">
                                    <span style="color: #64748b; font-size: 14px;">é€‰æ‹©æ­¤å›¾ç‰‡</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            list.innerHTML += '</div>';
        }
        
        async function approveImage(imageId) {
            try {
                const { error } = await supabase
                    .from('images')
                    .update({
                        status: 'approved',
                        reviewed_at: new Date(),
                        reviewed_by: currentUser.id
                    })
                    .eq('id', imageId);
                
                if (error) throw error;
                
                loadAdminData();
                loadPublicGallery();
                showMessage(document.getElementById('uploadInfo'), 'âœ… å›¾ç‰‡å·²æ‰¹å‡†', 'success');
            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            }
        }
        
        function showRejectModal(imageId) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼ˆå¯é€‰ï¼Œå°†æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰:');
            if (reason !== null) {
                rejectImage(imageId, reason || 'å›¾ç‰‡ä¸ç¬¦åˆ AirPhotos å†…å®¹è¦æ±‚');
            }
        }
        
        async function rejectImage(imageId, reason) {
            try {
                const { error } = await supabase
                    .from('images')
                    .update({
                        status: 'rejected',
                        rejection_reason: reason,
                        reviewed_at: new Date(),
                        reviewed_by: currentUser.id
                    })
                    .eq('id', imageId);
                
                if (error) throw error;
                
                loadAdminData();
                showMessage(document.getElementById('uploadInfo'), 'âŒ å›¾ç‰‡å·²æ‹’ç»', 'success');
            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            }
        }
        
        function approveAllSelected() {
            const checkboxes = document.querySelectorAll('.select-image:checked');
            if (checkboxes.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ‰¹å‡†çš„å›¾ç‰‡');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦æ‰¹å‡†é€‰ä¸­çš„ ${checkboxes.length} å¼ å›¾ç‰‡å—ï¼Ÿ`)) return;
            
            checkboxes.forEach(checkbox => {
                approveImage(checkbox.dataset.id);
            });
        }
        
        function rejectAllSelected() {
            const checkboxes = document.querySelectorAll('.select-image:checked');
            if (checkboxes.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ‹’ç»çš„å›¾ç‰‡');
                return;
            }
            
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼ˆé€‚ç”¨äºæ‰€æœ‰é€‰ä¸­å›¾ç‰‡ï¼‰:');
            if (reason === null) return;
            
            if (!confirm(`ç¡®å®šè¦æ‹’ç»é€‰ä¸­çš„ ${checkboxes.length} å¼ å›¾ç‰‡å—ï¼Ÿ`)) return;
            
            checkboxes.forEach(checkbox => {
                rejectImage(checkbox.dataset.id, reason);
            });
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        function showMessage(element, text, type = 'error') {
            element.textContent = text;
            element.className = `message ${type}`;
            element.style.display = 'block';
            
            if (type !== 'error') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }
        
        window.onclick = (event) => {
            const modal = document.getElementById('imageModal');
            if (event.target === modal) {
                closeModal();
            }
        };
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
