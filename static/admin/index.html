<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AirPhotos ç®¡ç†åå°</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
        margin: 0; 
        padding: 0; 
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); 
        min-height: 100vh; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
    }
    .login-container { 
        background: white; 
        padding: 50px; 
        border-radius: 20px; 
        box-shadow: 0 20px 60px rgba(14, 165, 233, 0.2); 
        text-align: center; 
        width: 100%; 
        max-width: 450px;
        border: 1px solid #bae6fd;
    }
    .logo {
        font-size: 36px;
        font-weight: bold;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #0ea5e9, #0369a1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .loader { 
        border: 4px solid #e2e8f0; 
        border-top: 4px solid #0ea5e9; 
        border-radius: 50%; 
        width: 50px; 
        height: 50px; 
        animation: spin 1s linear infinite; 
        margin: 30px auto; 
    }
    @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
    }
    h2 { 
        color: #0f172a; 
        margin-bottom: 10px; 
    }
    p { 
        color: #64748b; 
        margin-bottom: 30px; 
    }
    .error-container {
        padding: 40px;
        text-align: center;
    }
    .error-icon {
        font-size: 64px;
        margin-bottom: 20px;
        color: #ef4444;
    }
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-block;
        margin: 10px;
        text-decoration: none;
    }
    .btn-primary {
        background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
    }
    .btn-primary:hover {
        background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
    }
    .btn-outline {
        background: transparent;
        border: 2px solid #0ea5e9;
        color: #0ea5e9;
    }
    .btn-outline:hover {
        background: #f0f9ff;
    }
    .success-container {
        text-align: center;
        padding: 40px;
    }
    .success-icon {
        font-size: 64px;
        margin-bottom: 20px;
        color: #10b981;
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="logo">âœˆï¸ AirPhotos</div>
    <h2>ç®¡ç†åå°</h2>
    <p>æ­£åœ¨éªŒè¯ç®¡ç†å‘˜æƒé™...</p>
    <div class="loader"></div>
    <p id="message">è¯·ç¡®ä¿æ‚¨å·²æ‹¥æœ‰ç®¡ç†å‘˜æƒé™</p>
  </div>

  <script>
    // ğŸ”§ æ›¿æ¢ä¸ºä½ çš„ Supabase é…ç½®ï¼ˆä¸ä¸»é¡µé¢ç›¸åŒï¼‰
    const SUPABASE_URL = 'https://your-project.supabase.co';
    const SUPABASE_ANON_KEY = 'your-anon-key';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // ç®¡ç†å‘˜é‚®ç®±åˆ—è¡¨ï¼ˆåœ¨è¿™é‡Œæ·»åŠ ä½ çš„ç®¡ç†å‘˜é‚®ç®±ï¼‰
    const ADMIN_EMAILS = ['admin@example.com', 'steven@example.com'];
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    supabase.auth.onAuthStateChanged(async (user) => {
      if (user) {
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜
        if (ADMIN_EMAILS.includes(user.email)) {
          // ç®¡ç†å‘˜æƒé™éªŒè¯é€šè¿‡ï¼ŒåŠ è½½ Netlify CMS
          loadNetlifyCMS();
        } else {
          // æ™®é€šç”¨æˆ·ï¼Œæ˜¾ç¤ºæƒé™ä¸è¶³
          showPermissionDenied(user.email);
        }
      } else {
        // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
        redirectToLogin();
      }
    });
    
    // åŠ è½½ Netlify CMSï¼ˆç”¨äºç®¡ç†æ–‡ç« å†…å®¹ï¼‰
    function loadNetlifyCMS() {
      // æ˜¾ç¤ºåŠ è½½æˆåŠŸä¿¡æ¯
      document.body.innerHTML = `
        <div class="login-container">
          <div class="success-icon">âœ…</div>
          <h2>ç®¡ç†å‘˜éªŒè¯æˆåŠŸ</h2>
          <p>æ­£åœ¨åŠ è½½å†…å®¹ç®¡ç†åå°...</p>
          <div class="loader"></div>
          <p>è¯·ç¨å€™ï¼Œæ­£åœ¨åˆå§‹åŒ–ç¼–è¾‘å™¨</p>
        </div>
      `;
      
      // å»¶è¿ŸåŠ è½½ CMSï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒ
      setTimeout(() => {
        // åˆ›å»ºå¹¶åŠ è½½ Netlify CMS è„šæœ¬
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js';
        script.onload = () => {
          // ç§»é™¤åŠ è½½ç•Œé¢ï¼ŒNetlify CMS ä¼šè‡ªåŠ¨åˆå§‹åŒ–
          document.body.innerHTML = '';
          
          // å¯é€‰ï¼šæ·»åŠ è‡ªå®šä¹‰æ ·å¼
          const style = document.createElement('style');
          style.textContent = `
            /* è‡ªå®šä¹‰ CMS æ ·å¼ */
            .nc-app-header {
              background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%) !important;
            }
            .nc-app-header h1 {
              color: white !important;
            }
            .nc-button-primary {
              background: #0ea5e9 !important;
              border-color: #0ea5e9 !important;
            }
          `;
          document.head.appendChild(style);
        };
        
        script.onerror = () => {
          document.body.innerHTML = `
            <div class="error-container">
              <div class="error-icon">âš ï¸</div>
              <h2>åŠ è½½å¤±è´¥</h2>
              <p>æ— æ³•åŠ è½½å†…å®¹ç®¡ç†ç¼–è¾‘å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
              <button class="btn btn-primary" onclick="location.reload()">é‡è¯•</button>
              <a href="/login" class="btn btn-outline">è¿”å›ä¸»é¡µé¢</a>
            </div>
          `;
        };
        
        document.head.appendChild(script);
        
        // æ·»åŠ  Netlify CMS æ ·å¼
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'https://unpkg.com/netlify-cms@^2.0.0/dist/cms.css';
        document.head.appendChild(link);
        
      }, 1000);
    }
    
    // æ˜¾ç¤ºæƒé™ä¸è¶³é¡µé¢
    function showPermissionDenied(email) {
      document.body.innerHTML = `
        <div class="login-container">
          <div class="error-icon">ğŸš«</div>
          <h2>æƒé™ä¸è¶³</h2>
          <p>æ‚¨çš„è´¦å· <strong>${email}</strong> æ²¡æœ‰ç®¡ç†å‘˜æƒé™</p>
          <p style="font-size: 14px; margin-top: 20px;">å¦‚éœ€ç®¡ç†å‘˜æƒé™ï¼Œè¯·è”ç³»ç½‘ç«™æ‰€æœ‰è€…</p>
          <div style="margin-top: 30px;">
            <button class="btn btn-primary" onclick="logout()">é€€å‡ºç™»å½•</button>
            <a href="/login" class="btn btn-outline">è¿”å›ä¸»é¡µé¢</a>
          </div>
        </div>
      `;
    }
    
    // è·³è½¬åˆ°ç™»å½•é¡µé¢
    function redirectToLogin() {
      // æ˜¾ç¤ºé‡å®šå‘ä¿¡æ¯
      document.body.innerHTML = `
        <div class="login-container">
          <div class="logo">âœˆï¸ AirPhotos</div>
          <h2>è¯·å…ˆç™»å½•</h2>
          <p>æ­£åœ¨è·³è½¬åˆ°ç™»å½•é¡µé¢...</p>
          <div class="loader"></div>
          <p>å¦‚æœé¡µé¢æ²¡æœ‰è‡ªåŠ¨è·³è½¬ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹é“¾æ¥</p>
          <a href="/login" class="btn btn-primary" style="margin-top: 20px;">å‰å¾€ç™»å½•</a>
        </div>
      `;
      
      // 3ç§’åè‡ªåŠ¨è·³è½¬
      setTimeout(() => {
        window.location.href = '/login';
      }, 3000);
    }
    
    // é€€å‡ºç™»å½•
    function logout() {
      supabase.auth.signOut().then(() => {
        window.location.href = '/login';
      });
    }
    
    // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', (e) => {
      // Ctrl+Alt+L å¿«é€Ÿé€€å‡º
      if (e.ctrlKey && e.altKey && e.key === 'l') {
        logout();
      }
      // Esc é”®è¿”å›ä¸»é¡µ
      if (e.key === 'Escape') {
        window.location.href = '/login';
      }
    });
    
    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤º AirPhotos ç‰ˆæƒä¿¡æ¯
    window.onload = () => {
      // æ·»åŠ é¡µè„šç‰ˆæƒä¿¡æ¯
      const footer = document.createElement('div');
      footer.style.cssText = `
        position: fixed;
        bottom: 10px;
        right: 10px;
        color: #64748b;
        font-size: 12px;
        opacity: 0.7;
      `;
      footer.innerHTML = 'âœˆï¸ AirPhotos Admin v1.0';
      document.body.appendChild(footer);
    };
  </script>
</body>
</html>
